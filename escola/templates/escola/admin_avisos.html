{% extends 'escola/base_admin.html' %}
{% load static %}

{% block title %}Avisos - Administração{% endblock %}
{% block nav_avisos %}active{% endblock %}
{% block page_title %}Gerenciar Avisos{% endblock %}

{% block extra_css %}
<style>
    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
    .btn-primary { background: #092f76; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; display: inline-flex; align-items: center; gap: 8px; }
    .card { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); overflow: hidden; }
    .card-header { background: linear-gradient(90deg, #092f76, #003D96); color: white; padding: 16px 20px; font-weight: 600; }
    .card-body { padding: 20px; }
    .aviso-item { padding: 16px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: flex-start; }
    .aviso-item:last-child { border-bottom: none; }
    .aviso-content h4 { color: #092f76; margin: 0 0 8px 0; font-size: 16px; }
    .aviso-content p { color: #666; margin: 0; font-size: 14px; }
    .aviso-meta { font-size: 12px; color: #999; margin-top: 8px; }
    .badge { display: inline-block; padding: 3px 8px; border-radius: 10px; font-size: 11px; margin-left: 8px; }
    .badge-todos { background: #d4edda; color: #155724; }
    .badge-turma { background: #e3f2fd; color: #1565c0; }
    .btn-delete { background: #f8d7da; color: #721c24; padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
    .modal.active { display: flex; }
    .modal-content { background: white; border-radius: 12px; padding: 24px; width: 100%; max-width: 500px; }
    .modal-header { font-size: 18px; font-weight: 600; color: #092f76; margin-bottom: 20px; }
    .form-group { margin-bottom: 16px; }
    .form-group label { display: block; margin-bottom: 6px; font-weight: 500; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
    .form-group textarea { min-height: 100px; resize: vertical; }
    .modal-footer { display: flex; gap: 12px; justify-content: flex-end; margin-top: 20px; }
    .btn-cancel { background: #e0e0e0; color: #333; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <div></div>
    <button class="btn-primary" onclick="document.getElementById('addModal').classList.add('active')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        Novo Aviso
    </button>
</div>

<div class="card">
    <div class="card-header">Avisos Publicados</div>
    <div class="card-body" style="padding: 0;">
        {% for aviso in avisos %}
        <div class="aviso-item">
            <div class="aviso-content">
                <h4>{{ aviso.titulo }}
                    <span class="badge {% if aviso.destinatario == 'todos' %}badge-todos{% else %}badge-turma{% endif %}">{{ aviso.get_destinatario_display }}</span>
                </h4>
                <p>{{ aviso.conteudo|truncatewords:30 }}</p>
                <div class="aviso-meta">{{ aviso.data_criacao|date:"d/m/Y H:i" }} - por {{ aviso.autor.username|default:"Sistema" }}</div>
            </div>
            <form method="post" onsubmit="return confirm('Excluir este aviso?');">
                {% csrf_token %}
                <input type="hidden" name="action" value="delete">
                <input type="hidden" name="aviso_id" value="{{ aviso.id }}">
                <button type="submit" class="btn-delete">Excluir</button>
            </form>
        </div>
        {% empty %}
        <div style="padding: 30px; text-align: center; color: #666;">Nenhum aviso publicado.</div>
        {% endfor %}
    </div>
</div>

<div class="modal" id="addModal">
    <div class="modal-content">
        <div class="modal-header">Novo Aviso</div>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="add">
            <div class="form-group">
                <label>Título *</label>
                <input type="text" name="titulo" required>
            </div>
            <div class="form-group">
                <label>Conteúdo *</label>
                <textarea name="conteudo" required></textarea>
            </div>
            <div class="form-group">
                <label>Destinatário</label>
                <select name="destinatario">
                    <option value="todos">Todos</option>
                    <option value="alunos">Alunos</option>
                    <option value="professores">Professores</option>
                    <option value="turma">Turma Específica</option>
                </select>
            </div>
            <div class="form-group">
                <label>Turma (se aplicável)</label>
                <select name="turma">
                    <option value="">Todas</option>
                    {% for turma in turmas %}
                    <option value="{{ turma.id }}">{{ turma.codigo }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel" onclick="document.getElementById('addModal').classList.remove('active')">Cancelar</button>
                <button type="submit" class="btn-primary">Publicar</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
