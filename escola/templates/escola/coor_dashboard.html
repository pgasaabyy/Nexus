{% extends 'escola/base_coordenacao.html' %}
{% load static %}

{% block title %}Dashboard - Coordenação{% endblock %}
{% block nav_dashboard %}active{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block extra_css %}
<style>
    .dashboard-section { max-width: 1200px; }
    .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card { background: white; border-radius: 12px; padding: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #e0e0e0; }
    .stat-info .stat-value { font-size: 28px; font-weight: 600; color: #003366; display: block; }
    .stat-info .stat-label { font-size: 14px; color: #666; }
    .stat-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; }
    .stat-icon.blue { background: #003366; }
    .stat-icon.green { background: #28a745; }
    .stat-icon.purple { background: #6f42c1; }
    .content-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; }
    .content-card { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); overflow: hidden; }
    .card-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; background: #f8f8f8; border-bottom: 1px solid #e0e0e0; }
    .card-header h3 { font-size: 16px; font-weight: 600; color: #333; margin: 0; }
    .card-body { padding: 20px; }
    .data-table { width: 100%; border-collapse: collapse; }
    .data-table th, .data-table td { padding: 10px; text-align: left; border-bottom: 1px solid #f0f0f0; }
    .data-table th { font-weight: 600; color: #666; font-size: 13px; }
    .avisos-list { display: flex; flex-direction: column; gap: 12px; }
    .aviso-item { 
        display: flex; 
        align-items: flex-start; 
        gap: 12px; 
        padding: 14px; 
        background: #f8f9fa; 
        border-radius: 10px; 
        border-left: 4px solid #003366;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .aviso-item:hover {
        transform: translateX(4px);
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .aviso-date-badge {
        background: #003366;
        color: white;
        padding: 8px 10px;
        border-radius: 8px;
        text-align: center;
        min-width: 45px;
    }
    .aviso-date-day { font-size: 18px; font-weight: 700; }
    .aviso-date-month { font-size: 10px; text-transform: uppercase; }
    .aviso-content { flex: 1; }
    .aviso-title { font-weight: 600; color: #333; font-size: 14px; margin-bottom: 4px; }
    .aviso-desc { font-size: 12px; color: #666; line-height: 1.4; }
    .link-more { color: #003366; text-decoration: none; font-size: 14px; font-weight: 500; }
    .link-more:hover { text-decoration: underline; }
    .empty-message { color: #666; text-align: center; padding: 20px; }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-section">
    <div class="stats-row">
        <div class="stat-card">
            <div class="stat-info">
                <span class="stat-value">{{ total_alunos }}</span>
                <span class="stat-label">Total de Alunos</span>
            </div>
            <div class="stat-icon blue">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-info">
                <span class="stat-value">{{ total_professores }}</span>
                <span class="stat-label">Professores</span>
            </div>
            <div class="stat-icon green">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                    <line x1="8" y1="21" x2="16" y2="21"></line>
                    <line x1="12" y1="17" x2="12" y2="21"></line>
                </svg>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-info">
                <span class="stat-value">{{ total_turmas }}</span>
                <span class="stat-label">Turmas Ativas</span>
            </div>
            <div class="stat-icon purple">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
            </div>
        </div>
    </div>
    
    <div class="content-grid">
        <div class="content-card">
            <div class="card-header">
                <h3>Turmas por Número de Alunos</h3>
            </div>
            <div class="card-body">
                {% if turmas %}
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Turma</th>
                            <th>Alunos</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for turma in turmas %}
                        <tr>
                            <td>{{ turma.codigo }}</td>
                            <td>{{ turma.total_alunos }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p class="empty-message">Nenhuma turma cadastrada.</p>
                {% endif %}
            </div>
        </div>
        
        <div class="content-card">
            <div class="card-header">
                <h3>Avisos Recentes</h3>
                <a href="{% url 'coordenacao_comunicados' %}" class="link-more">Ver todos</a>
            </div>
            <div class="card-body">
                {% if avisos %}
                <div class="avisos-list">
                    {% for aviso in avisos %}
                    <div class="aviso-item">
                        <div class="aviso-date-badge">
                            <div class="aviso-date-day">{{ aviso.data_criacao|date:"d" }}</div>
                            <div class="aviso-date-month">{{ aviso.data_criacao|date:"M" }}</div>
                        </div>
                        <div class="aviso-content">
                            <div class="aviso-title">{{ aviso.titulo }}</div>
                            <div class="aviso-desc">{{ aviso.conteudo|truncatewords:15|default:"Clique para ver mais detalhes" }}</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="empty-message">Nenhum aviso recente.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
