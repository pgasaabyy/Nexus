{% extends 'escola/base_coordenacao.html' %}
{% load static %}

{% block title %}Professores - Coordenação{% endblock %}
{% block nav_professores %}active{% endblock %}
{% block page_title %}Gestão de Professores{% endblock %}

{% block extra_css %}
<style>
    .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card { background: white; border-radius: 12px; padding: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #e0e0e0; }
    .stat-info .stat-value { font-size: 28px; font-weight: 600; color: #003366; display: block; }
    .stat-info .stat-label { font-size: 14px; color: #666; }
    .stat-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; }
    .stat-icon.green { background: #28a745; }
    .content-card { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); overflow: hidden; }
    .card-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; background: #f8f8f8; border-bottom: 1px solid #e0e0e0; }
    .card-header h3 { font-size: 16px; font-weight: 600; color: #333; margin: 0; }
    .btn-add { display: inline-flex; align-items: center; gap: 8px; padding: 10px 18px; background: #003366; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; text-decoration: none; transition: background 0.2s; }
    .btn-add:hover { background: #002244; }
    .card-body { padding: 20px; }
    .search-bar { display: flex; gap: 12px; margin-bottom: 20px; }
    .search-bar input { flex: 1; padding: 10px 14px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; }
    .search-bar input:focus { outline: none; border-color: #003366; }
    .data-table { width: 100%; border-collapse: collapse; }
    .data-table th, .data-table td { padding: 12px 16px; text-align: left; border-bottom: 1px solid #f0f0f0; }
    .data-table th { font-weight: 600; color: #333; font-size: 13px; background: #f8f9fa; }
    .data-table tbody tr:hover { background: #f8f9fa; }
    .empty-message { color: #666; text-align: center; padding: 40px; }
    .status-tag { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; background: #d4edda; color: #155724; }
    .actions { display: flex; gap: 8px; }
    .btn-action { padding: 6px 10px; border: none; border-radius: 6px; cursor: pointer; text-decoration: none; font-size: 12px; transition: all 0.2s; display: inline-flex; align-items: center; gap: 4px; }
    .btn-edit { background: #e3f2fd; color: #1565c0; }
    .btn-edit:hover { background: #1565c0; color: white; }
    .btn-delete { background: #ffebee; color: #c62828; }
    .btn-delete:hover { background: #c62828; color: white; }
    .btn-view { background: #e8f5e9; color: #2e7d32; }
    .btn-view:hover { background: #2e7d32; color: white; }
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; }
    .modal-overlay.active { display: flex; }
    .modal-content { background: white; border-radius: 12px; padding: 24px; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .modal-header h3 { margin: 0; color: #003366; }
    .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: #666; }
    .form-group { margin-bottom: 16px; }
    .form-group label { display: block; margin-bottom: 6px; font-weight: 600; color: #333; font-size: 14px; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; }
    .form-group input:focus, .form-group select:focus { outline: none; border-color: #003366; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .btn-submit { width: 100%; padding: 12px; background: #003366; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; }
    .btn-submit:hover { background: #002244; }
</style>
{% endblock %}

{% block content %}
<div class="stats-row">
    <div class="stat-card">
        <div class="stat-info">
            <span class="stat-value">{{ professores|length }}</span>
            <span class="stat-label">Total de Professores</span>
        </div>
        <div class="stat-icon green">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
        </div>
    </div>
</div>

<div class="content-card">
    <div class="card-header">
        <h3>Corpo Docente</h3>
        <button class="btn-add" onclick="openModal('addModal')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Novo Professor
        </button>
    </div>
    <div class="card-body">
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Pesquisar por nome, email ou especialidade...">
        </div>
        {% if professores %}
        <table class="data-table" id="professoresTable">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Email</th>
                    <th>Telefone</th>
                    <th>Especialidade</th>
                    <th>Data Admissão</th>
                    <th>Status</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for professor in professores %}
                <tr>
                    <td><strong>{{ professor.nome }}</strong></td>
                    <td>{{ professor.email }}</td>
                    <td>{{ professor.telefone|default:"-" }}</td>
                    <td>{{ professor.especialidade|default:"Geral" }}</td>
                    <td>{{ professor.data_admissao|date:"d/m/Y" }}</td>
                    <td><span class="status-tag">Ativo</span></td>
                    <td class="actions">
                        <button class="btn-action btn-view" onclick="viewProfessor({{ professor.id }}, '{{ professor.nome }}', '{{ professor.email }}', '{{ professor.telefone|default:"" }}', '{{ professor.especialidade|default:"" }}', '{{ professor.data_admissao|date:"Y-m-d" }}')">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                            Ver
                        </button>
                        <button class="btn-action btn-edit" onclick="editProfessor({{ professor.id }}, '{{ professor.nome }}', '{{ professor.email }}', '{{ professor.telefone|default:"" }}', '{{ professor.especialidade|default:"" }}', '{{ professor.data_admissao|date:"Y-m-d" }}')">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            Editar
                        </button>
                        <form method="POST" action="{% url 'coordenacao_professor_excluir' professor.id %}" style="display: inline;" onsubmit="return confirm('Tem certeza que deseja excluir este professor?')">
                            {% csrf_token %}
                            <button type="submit" class="btn-action btn-delete">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                </svg>
                                Excluir
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="empty-message">Nenhum professor cadastrado. Clique em "Novo Professor" para começar.</p>
        {% endif %}
    </div>
</div>

<div class="modal-overlay" id="addModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Adicionar Professor</h3>
            <button class="modal-close" onclick="closeModal('addModal')">&times;</button>
        </div>
        <form method="POST" action="{% url 'coordenacao_professor_adicionar' %}">
            {% csrf_token %}
            <div class="form-group">
                <label>Nome Completo *</label>
                <input type="text" name="nome" required placeholder="Digite o nome completo">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required placeholder="email@exemplo.com">
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="text" name="telefone" placeholder="(00) 00000-0000">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Especialidade</label>
                    <input type="text" name="especialidade" placeholder="Ex: Matemática">
                </div>
                <div class="form-group">
                    <label>Data de Admissão *</label>
                    <input type="date" name="data_admissao" required>
                </div>
            </div>
            <div class="form-group">
                <label>Criar usuário de acesso</label>
                <select name="criar_usuario">
                    <option value="sim">Sim, criar usuário com senha padrão</option>
                    <option value="nao">Não criar usuário</option>
                </select>
            </div>
            <button type="submit" class="btn-submit">Adicionar Professor</button>
        </form>
    </div>
</div>

<div class="modal-overlay" id="editModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Editar Professor</h3>
            <button class="modal-close" onclick="closeModal('editModal')">&times;</button>
        </div>
        <form method="POST" id="editForm">
            {% csrf_token %}
            <div class="form-group">
                <label>Nome Completo *</label>
                <input type="text" name="nome" id="edit_nome" required>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" id="edit_email" required>
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="text" name="telefone" id="edit_telefone">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Especialidade</label>
                    <input type="text" name="especialidade" id="edit_especialidade">
                </div>
                <div class="form-group">
                    <label>Data de Admissão *</label>
                    <input type="date" name="data_admissao" id="edit_data_admissao" required>
                </div>
            </div>
            <button type="submit" class="btn-submit">Salvar Alterações</button>
        </form>
    </div>
</div>

<div class="modal-overlay" id="viewModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Detalhes do Professor</h3>
            <button class="modal-close" onclick="closeModal('viewModal')">&times;</button>
        </div>
        <div style="padding: 10px 0;">
            <p><strong>Nome:</strong> <span id="view_nome"></span></p>
            <p><strong>Email:</strong> <span id="view_email"></span></p>
            <p><strong>Telefone:</strong> <span id="view_telefone"></span></p>
            <p><strong>Especialidade:</strong> <span id="view_especialidade"></span></p>
            <p><strong>Data de Admissão:</strong> <span id="view_data_admissao"></span></p>
        </div>
    </div>
</div>

<script>
function openModal(id) {
    document.getElementById(id).classList.add('active');
}

function closeModal(id) {
    document.getElementById(id).classList.remove('active');
}

function editProfessor(id, nome, email, telefone, especialidade, dataAdmissao) {
    document.getElementById('edit_nome').value = nome;
    document.getElementById('edit_email').value = email;
    document.getElementById('edit_telefone').value = telefone;
    document.getElementById('edit_especialidade').value = especialidade;
    document.getElementById('edit_data_admissao').value = dataAdmissao;
    document.getElementById('editForm').action = '/dashboard/coordenacao/professores/' + id + '/editar/';
    openModal('editModal');
}

function viewProfessor(id, nome, email, telefone, especialidade, dataAdmissao) {
    document.getElementById('view_nome').textContent = nome;
    document.getElementById('view_email').textContent = email;
    document.getElementById('view_telefone').textContent = telefone || '-';
    document.getElementById('view_especialidade').textContent = especialidade || 'Geral';
    const date = new Date(dataAdmissao + 'T00:00:00');
    document.getElementById('view_data_admissao').textContent = date.toLocaleDateString('pt-BR');
    openModal('viewModal');
}

document.getElementById('searchInput').addEventListener('keyup', function() {
    const termo = this.value.toLowerCase();
    const linhas = document.querySelectorAll('#professoresTable tbody tr');
    linhas.forEach(function(linha) {
        const texto = linha.textContent.toLowerCase();
        linha.style.display = texto.includes(termo) ? '' : 'none';
    });
});

document.querySelectorAll('.modal-overlay').forEach(function(modal) {
    modal.addEventListener('click', function(e) {
        if (e.target === modal) closeModal(modal.id);
    });
});
</script>
{% endblock %}
