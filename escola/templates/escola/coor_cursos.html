{% extends 'escola/base_coordenacao.html' %}
{% load static %}

{% block title %}Cursos - Coordenacao{% endblock %}
{% block nav_cursos %}active{% endblock %}
{% block page_title %}Gestao de Cursos{% endblock %}

{% block extra_css %}
<style>
    .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card { background: white; border-radius: 12px; padding: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #e0e0e0; }
    .stat-info .stat-value { font-size: 28px; font-weight: 600; color: #003366; display: block; }
    .stat-info .stat-label { font-size: 14px; color: #666; }
    .stat-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; background: #003366; }
    .content-card { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); overflow: hidden; }
    .card-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; background: #f8f8f8; border-bottom: 1px solid #e0e0e0; }
    .card-header h3 { font-size: 16px; font-weight: 600; color: #333; margin: 0; }
    .btn-add { display: inline-flex; align-items: center; gap: 8px; padding: 10px 18px; background: #003366; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; text-decoration: none; transition: background 0.2s; }
    .btn-add:hover { background: #002244; }
    .card-body { padding: 20px; }
    .data-table { width: 100%; border-collapse: collapse; }
    .data-table th, .data-table td { padding: 12px 16px; text-align: left; border-bottom: 1px solid #f0f0f0; }
    .data-table th { font-weight: 600; color: #333; font-size: 13px; background: #f8f9fa; }
    .data-table tbody tr:hover { background: #f8f9fa; }
    .empty-message { color: #666; text-align: center; padding: 40px; }
    .badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; background: #e3f2fd; color: #1565c0; }
    .actions { display: flex; gap: 6px; }
    .btn-action { padding: 6px 10px; border: none; border-radius: 6px; cursor: pointer; text-decoration: none; font-size: 12px; transition: all 0.2s; display: inline-flex; align-items: center; gap: 4px; }
    .btn-edit { background: #e3f2fd; color: #1565c0; }
    .btn-edit:hover { background: #1565c0; color: white; }
    .btn-delete { background: #ffebee; color: #c62828; }
    .btn-delete:hover { background: #c62828; color: white; }
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; }
    .modal-overlay.active { display: flex; }
    .modal-content { background: white; border-radius: 12px; padding: 24px; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .modal-header h3 { margin: 0; color: #003366; }
    .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: #666; }
    .form-group { margin-bottom: 16px; }
    .form-group label { display: block; margin-bottom: 6px; font-weight: 600; color: #333; font-size: 14px; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #003366; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .btn-submit { width: 100%; padding: 12px; background: #003366; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; }
    .btn-submit:hover { background: #002244; }
</style>
{% endblock %}

{% block content %}
<div class="stats-row">
    <div class="stat-card">
        <div class="stat-info">
            <span class="stat-value">{{ cursos|length }}</span>
            <span class="stat-label">Total de Cursos</span>
        </div>
        <div class="stat-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 10v6M2 10l10-5 10 5-10 5z"></path>
                <path d="M6 12v5c3 3 9 3 12 0v-5"></path>
            </svg>
        </div>
    </div>
</div>

<div class="content-card">
    <div class="card-header">
        <h3>Cursos Cadastrados</h3>
        <button class="btn-add" onclick="openModal('addModal')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Novo Curso
        </button>
    </div>
    <div class="card-body">
        {% if cursos %}
        <table class="data-table">
            <thead>
                <tr>
                    <th>Codigo</th>
                    <th>Nome</th>
                    <th>Carga Horaria</th>
                    <th>Turmas</th>
                    <th>Disciplinas</th>
                    <th>Acoes</th>
                </tr>
            </thead>
            <tbody>
                {% for curso in cursos %}
                <tr>
                    <td><strong>{{ curso.codigo }}</strong></td>
                    <td>{{ curso.nome }}</td>
                    <td>{{ curso.carga_horaria }}h</td>
                    <td><span class="badge">{{ curso.total_turmas }}</span></td>
                    <td><span class="badge">{{ curso.total_disciplinas }}</span></td>
                    <td class="actions">
                        <button class="btn-action btn-edit" onclick="editCurso({{ curso.id }}, '{{ curso.codigo }}', '{{ curso.nome }}', '{{ curso.descricao|default:""|escapejs }}', '{{ curso.carga_horaria }}')">
                            Editar
                        </button>
                        <form method="POST" action="{% url 'coordenacao_curso_excluir' curso.id %}" style="display: inline;" onsubmit="return confirm('Tem certeza que deseja excluir este curso? Turmas e disciplinas vinculadas podem ser afetadas.')">
                            {% csrf_token %}
                            <button type="submit" class="btn-action btn-delete">Excluir</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="empty-message">Nenhum curso cadastrado. Clique em "Novo Curso" para comecar.</p>
        {% endif %}
    </div>
</div>

<div class="modal-overlay" id="addModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Adicionar Curso</h3>
            <button class="modal-close" onclick="closeModal('addModal')">&times;</button>
        </div>
        <form method="POST" action="{% url 'coordenacao_curso_adicionar' %}">
            {% csrf_token %}
            <div class="form-row">
                <div class="form-group">
                    <label>Codigo *</label>
                    <input type="text" name="codigo" required placeholder="Ex: ADM, ENG, TI">
                </div>
                <div class="form-group">
                    <label>Carga Horaria (h) *</label>
                    <input type="number" name="carga_horaria" required placeholder="Ex: 2400">
                </div>
            </div>
            <div class="form-group">
                <label>Nome do Curso *</label>
                <input type="text" name="nome" required placeholder="Digite o nome completo do curso">
            </div>
            <div class="form-group">
                <label>Descricao</label>
                <textarea name="descricao" rows="3" placeholder="Descricao do curso (opcional)"></textarea>
            </div>
            <button type="submit" class="btn-submit">Adicionar Curso</button>
        </form>
    </div>
</div>

<div class="modal-overlay" id="editModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Editar Curso</h3>
            <button class="modal-close" onclick="closeModal('editModal')">&times;</button>
        </div>
        <form method="POST" id="editForm">
            {% csrf_token %}
            <div class="form-row">
                <div class="form-group">
                    <label>Codigo *</label>
                    <input type="text" name="codigo" id="edit_codigo" required>
                </div>
                <div class="form-group">
                    <label>Carga Horaria (h) *</label>
                    <input type="number" name="carga_horaria" id="edit_carga_horaria" required>
                </div>
            </div>
            <div class="form-group">
                <label>Nome do Curso *</label>
                <input type="text" name="nome" id="edit_nome" required>
            </div>
            <div class="form-group">
                <label>Descricao</label>
                <textarea name="descricao" id="edit_descricao" rows="3"></textarea>
            </div>
            <button type="submit" class="btn-submit">Salvar Alteracoes</button>
        </form>
    </div>
</div>

<script>
function openModal(id) {
    document.getElementById(id).classList.add('active');
}

function closeModal(id) {
    document.getElementById(id).classList.remove('active');
}

function editCurso(id, codigo, nome, descricao, cargaHoraria) {
    document.getElementById('edit_codigo').value = codigo;
    document.getElementById('edit_nome').value = nome;
    document.getElementById('edit_descricao').value = descricao;
    document.getElementById('edit_carga_horaria').value = cargaHoraria;
    document.getElementById('editForm').action = '/dashboard/coordenacao/cursos/' + id + '/editar/';
    openModal('editModal');
}

document.querySelectorAll('.modal-overlay').forEach(function(modal) {
    modal.addEventListener('click', function(e) {
        if (e.target === modal) closeModal(modal.id);
    });
});
</script>
{% endblock %}
