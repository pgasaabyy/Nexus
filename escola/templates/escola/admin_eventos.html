{% extends 'escola/base_admin.html' %}
{% load static %}

{% block title %}Eventos - Administração{% endblock %}
{% block nav_eventos %}active{% endblock %}
{% block page_title %}Gerenciar Eventos{% endblock %}

{% block extra_css %}
<style>
    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
    .btn-primary { background: #092f76; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; display: inline-flex; align-items: center; gap: 8px; }
    .card { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); overflow: hidden; }
    .card-header { background: linear-gradient(90deg, #092f76, #003D96); color: white; padding: 16px 20px; font-weight: 600; }
    .card-body { padding: 20px; }
    .data-table { width: 100%; border-collapse: collapse; }
    .data-table th { text-align: left; padding: 12px; background: #f8f8f8; border-bottom: 2px solid #e0e0e0; font-weight: 600; color: #333; }
    .data-table td { padding: 12px; border-bottom: 1px solid #f0f0f0; }
    .data-table tr:hover { background-color: #f8fafc; }
    .badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 500; }
    .badge-feriado { background: #ffeeba; color: #856404; }
    .badge-prova { background: #f8d7da; color: #721c24; }
    .badge-evento { background: #d4edda; color: #155724; }
    .btn-delete { background: #f8d7da; color: #721c24; padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
    .modal.active { display: flex; }
    .modal-content { background: white; border-radius: 12px; padding: 24px; width: 100%; max-width: 500px; }
    .modal-header { font-size: 18px; font-weight: 600; color: #092f76; margin-bottom: 20px; }
    .form-group { margin-bottom: 16px; }
    .form-group label { display: block; margin-bottom: 6px; font-weight: 500; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
    .modal-footer { display: flex; gap: 12px; justify-content: flex-end; margin-top: 20px; }
    .btn-cancel { background: #e0e0e0; color: #333; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <div></div>
    <button class="btn-primary" onclick="document.getElementById('addModal').classList.add('active')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        Novo Evento
    </button>
</div>

<div class="card">
    <div class="card-header">Calendário de Eventos</div>
    <div class="card-body">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Título</th>
                    <th>Tipo</th>
                    <th>Turma</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for evento in eventos %}
                <tr>
                    <td><strong>{{ evento.data|date:"d/m/Y" }}</strong></td>
                    <td>{{ evento.titulo }}</td>
                    <td>
                        <span class="badge badge-{{ evento.tipo }}">{{ evento.get_tipo_display }}</span>
                    </td>
                    <td>{{ evento.turma.codigo|default:"Todas" }}</td>
                    <td>
                        <form method="post" style="display: inline;" onsubmit="return confirm('Excluir este evento?');">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="delete">
                            <input type="hidden" name="evento_id" value="{{ evento.id }}">
                            <button type="submit" class="btn-delete">Excluir</button>
                        </form>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="5" style="text-align:center; padding:30px; color:#666;">Nenhum evento cadastrado.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="modal" id="addModal">
    <div class="modal-content">
        <div class="modal-header">Novo Evento</div>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="add">
            <div class="form-group">
                <label>Título *</label>
                <input type="text" name="titulo" required>
            </div>
            <div class="form-group">
                <label>Data *</label>
                <input type="date" name="data" required>
            </div>
            <div class="form-group">
                <label>Tipo *</label>
                <select name="tipo" required>
                    {% for tipo in tipos_evento %}
                    <option value="{{ tipo.0 }}">{{ tipo.1 }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label>Descrição</label>
                <textarea name="descricao"></textarea>
            </div>
            <div class="form-group">
                <label>Turma (opcional)</label>
                <select name="turma">
                    <option value="">Todas as turmas</option>
                    {% for turma in turmas %}
                    <option value="{{ turma.id }}">{{ turma.codigo }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel" onclick="document.getElementById('addModal').classList.remove('active')">Cancelar</button>
                <button type="submit" class="btn-primary">Criar Evento</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
