{% extends 'escola/base_admin.html' %}
{% load static %}

{% block title %}Cursos - Administração{% endblock %}
{% block nav_cursos %}active{% endblock %}
{% block page_title %}Gerenciar Cursos{% endblock %}

{% block extra_css %}
<style>
    .page-header { display: flex; justify-content: flex-end; margin-bottom: 24px; gap: 12px; }
    .btn-primary { background: #092f76; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; display: inline-flex; align-items: center; gap: 8px; }
    .btn-primary:hover { background: #003D96; }
    .btn-secondary { background: #8ed6d7; color: #092f76; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; display: inline-flex; align-items: center; gap: 8px; }
    .card { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); overflow: hidden; margin-bottom: 24px; }
    .card-header { background: linear-gradient(90deg, #092f76, #003D96); color: white; padding: 16px 20px; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
    .card-body { padding: 20px; overflow-x: auto; }
    .data-table { width: 100%; border-collapse: collapse; }
    .data-table th { text-align: left; padding: 12px; background: #f8f8f8; border-bottom: 2px solid #e0e0e0; font-weight: 600; color: #333; font-size: 13px; }
    .data-table td { padding: 12px; border-bottom: 1px solid #f0f0f0; }
    .data-table tr:hover { background-color: #f8fafc; }
    .badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 500; background: #d4edda; color: #155724; }
    .total-count { background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 14px; }
    .actions { display: flex; gap: 8px; }
    .btn-sm { padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; }
    .btn-edit { background: #8ed6d7; color: #092f76; }
    .btn-delete { background: #f8d7da; color: #721c24; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
    .modal.active { display: flex; }
    .modal-content { background: white; border-radius: 12px; padding: 24px; width: 100%; max-width: 500px; }
    .modal-header { font-size: 18px; font-weight: 600; color: #092f76; margin-bottom: 20px; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .form-group { margin-bottom: 16px; }
    .form-group label { display: block; margin-bottom: 6px; font-weight: 500; color: #333; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; box-sizing: border-box; }
    .form-group textarea { resize: vertical; min-height: 80px; }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #092f76; }
    .modal-footer { display: flex; gap: 12px; justify-content: flex-end; margin-top: 20px; }
    .btn-cancel { background: #e0e0e0; color: #333; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <button class="btn-secondary" onclick="openModal('addDisciplinaModal')">Nova Disciplina</button>
    <button class="btn-primary" onclick="openModal('addCursoModal')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        Novo Curso
    </button>
</div>

<div class="card">
    <div class="card-header">
        <span>Lista de Cursos</span>
        <span class="total-count">{{ cursos.count }} cursos</span>
    </div>
    <div class="card-body">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Código</th>
                    <th>Carga Horária</th>
                    <th>Turmas</th>
                    <th>Disciplinas</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for curso in cursos %}
                <tr>
                    <td><strong>{{ curso.nome }}</strong></td>
                    <td>{{ curso.codigo }}</td>
                    <td>{{ curso.carga_horaria }}h</td>
                    <td><span class="badge">{{ curso.total_turmas }}</span></td>
                    <td>{{ curso.total_disciplinas }}</td>
                    <td class="actions">
                        <button class="btn-sm btn-edit" data-id="{{ curso.id }}" data-nome="{{ curso.nome }}" data-codigo="{{ curso.codigo }}" data-carga="{{ curso.carga_horaria }}" data-descricao="{{ curso.descricao|default:'' }}">Editar</button>
                        <form method="post" style="display:inline;" onsubmit="return confirm('Excluir este curso?');">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="delete_curso">
                            <input type="hidden" name="curso_id" value="{{ curso.id }}">
                            <button type="submit" class="btn-sm btn-delete">Excluir</button>
                        </form>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="6" style="text-align:center; padding:30px; color:#666;">Nenhum curso encontrado.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <span>Disciplinas</span>
        <span class="total-count">{{ disciplinas.count }} disciplinas</span>
    </div>
    <div class="card-body">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Curso</th>
                    <th>Ementa</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for disc in disciplinas %}
                <tr>
                    <td><strong>{{ disc.nome }}</strong></td>
                    <td>{{ disc.curso.nome }}</td>
                    <td>{{ disc.ementa|truncatewords:10|default:"-" }}</td>
                    <td>
                        <form method="post" style="display:inline;" onsubmit="return confirm('Excluir esta disciplina?');">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="delete_disciplina">
                            <input type="hidden" name="disciplina_id" value="{{ disc.id }}">
                            <button type="submit" class="btn-sm btn-delete">Excluir</button>
                        </form>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="4" style="text-align:center; padding:30px; color:#666;">Nenhuma disciplina encontrada.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="modal" id="addCursoModal">
    <div class="modal-content">
        <div class="modal-header">Novo Curso</div>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="add_curso">
            <div class="form-row">
                <div class="form-group">
                    <label>Nome *</label>
                    <input type="text" name="nome" required>
                </div>
                <div class="form-group">
                    <label>Código *</label>
                    <input type="text" name="codigo" required>
                </div>
            </div>
            <div class="form-group">
                <label>Carga Horária (horas) *</label>
                <input type="number" name="carga_horaria" required min="1">
            </div>
            <div class="form-group">
                <label>Descrição</label>
                <textarea name="descricao"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel" onclick="closeModal('addCursoModal')">Cancelar</button>
                <button type="submit" class="btn-primary">Criar Curso</button>
            </div>
        </form>
    </div>
</div>

<div class="modal" id="editCursoModal">
    <div class="modal-content">
        <div class="modal-header">Editar Curso</div>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="edit_curso">
            <input type="hidden" name="curso_id" id="edit_curso_id">
            <div class="form-row">
                <div class="form-group">
                    <label>Nome</label>
                    <input type="text" name="nome" id="edit_curso_nome">
                </div>
                <div class="form-group">
                    <label>Código</label>
                    <input type="text" name="codigo" id="edit_curso_codigo">
                </div>
            </div>
            <div class="form-group">
                <label>Carga Horária (horas)</label>
                <input type="number" name="carga_horaria" id="edit_curso_carga" min="1">
            </div>
            <div class="form-group">
                <label>Descrição</label>
                <textarea name="descricao" id="edit_curso_descricao"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel" onclick="closeModal('editCursoModal')">Cancelar</button>
                <button type="submit" class="btn-primary">Salvar</button>
            </div>
        </form>
    </div>
</div>

<div class="modal" id="addDisciplinaModal">
    <div class="modal-content">
        <div class="modal-header">Nova Disciplina</div>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="add_disciplina">
            <div class="form-group">
                <label>Nome *</label>
                <input type="text" name="nome" required>
            </div>
            <div class="form-group">
                <label>Curso *</label>
                <select name="curso" required>
                    <option value="">Selecione...</option>
                    {% for curso in cursos %}
                    <option value="{{ curso.id }}">{{ curso.nome }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label>Ementa</label>
                <textarea name="ementa"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel" onclick="closeModal('addDisciplinaModal')">Cancelar</button>
                <button type="submit" class="btn-primary">Criar Disciplina</button>
            </div>
        </form>
    </div>
</div>

<script>
function openModal(id) { document.getElementById(id).classList.add('active'); }
function closeModal(id) { document.getElementById(id).classList.remove('active'); }

document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.btn-edit').forEach(function(btn) {
        btn.addEventListener('click', function() {
            document.getElementById('edit_curso_id').value = this.getAttribute('data-id');
            document.getElementById('edit_curso_nome').value = this.getAttribute('data-nome');
            document.getElementById('edit_curso_codigo').value = this.getAttribute('data-codigo');
            document.getElementById('edit_curso_carga').value = this.getAttribute('data-carga');
            document.getElementById('edit_curso_descricao').value = this.getAttribute('data-descricao');
            openModal('editCursoModal');
        });
    });
    
    document.querySelectorAll('.modal').forEach(function(modal) {
        modal.addEventListener('click', function(e) {
            if (e.target === modal) closeModal(modal.id);
        });
    });
});
</script>
{% endblock %}
